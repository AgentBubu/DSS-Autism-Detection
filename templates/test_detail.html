{% extends "layout.html" %}
{% block content %}
<div class="row justify-content-center pb-5">
    <div class="col-md-11">
        <div class="d-flex justify-content-between align-items-center mb-4 page-enter-animation">
            <h2 class="fw-bold mb-0">Detail Riwayat Tes</h2>
            <a href="/history" class="btn btn-outline-secondary rounded-pill px-4">
                <i class="bi bi-arrow-left me-2"></i> Kembali
            </a>
        </div>

        <div class="row g-4 page-enter-animation">
            
            <!-- LEFT COLUMN: RESULT SUMMARY -->
            <div class="col-md-5">
                <div class="card p-4 h-100 shadow-sm">
                    <div class="text-center mb-4">
                        <div class="mb-2">
                            <i class="bi bi-person-circle display-4 text-primary opacity-50"></i>
                        </div>
                        <h3 class="fw-bold">{{ result.name }}</h3>
                        <div class="text-muted small">{{ result.date }}</div>
                    </div>

                    <!-- Profile Badges -->
                    <div class="d-flex flex-wrap justify-content-center gap-2 mb-4">
                        <span class="badge bg-light text-dark border"><i class="bi bi-calendar me-1"></i> {{ result.dob }}</span>
                        <span class="badge bg-light text-dark border"><i class="bi bi-gender-ambiguous me-1"></i> {{ result.gender }}</span>
                    </div>

                    <hr>

                    <!-- Score Box -->
                    <div class="text-center my-4">
                        <h6 class="text-uppercase text-muted small ls-1">Skor Risiko</h6>
                        <h1 class="display-3 fw-bold text-primary mb-0">{{ result.score }}</h1>
                        {% if result.risk == 'High' %}
                            <span class="badge bg-danger mt-2 px-3 py-2">Tinggi</span>
                        {% elif result.risk == 'Medium' %}
                            <span class="badge bg-warning text-dark mt-2 px-3 py-2">Sedang</span>
                        {% else %}
                            <span class="badge bg-success mt-2 px-3 py-2">Rendah</span>
                        {% endif %}
                    </div>

                    <!-- Recommendation -->
                    <div class="bg-primary bg-opacity-10 p-3 rounded text-center border border-primary border-opacity-25">
                        <h6 class="text-primary fw-bold text-uppercase small mb-2">Rekomendasi Program</h6>
                        <h5 class="fw-bold mb-0">{{ result.program_name }}</h5>
                    </div>

                    <!-- Prominent Criteria -->
                    <div class="mt-4">
                        <label class="small text-muted fw-bold text-uppercase">Gejala Paling Menonjol</label>
                        <div class="d-flex justify-content-between align-items-center mt-1">
                            <span>{{ result.prominent_criteria.name }}</span>
                            <span class="fw-bold text-dark">{{ result.prominent_criteria.value }}</span>
                        </div>
                        <div class="progress mt-2" style="height: 6px;">
                            <div class="progress-bar bg-secondary" role="progressbar" style="width: {{ (result.prominent_criteria.value * 100)|int }}%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: Q&A LIST -->
            <div class="col-md-7">
                <div class="card p-4 h-100 shadow-sm">
                    <h5 class="fw-bold mb-4 border-bottom pb-3">Jawaban Kuesioner (AQ-10)</h5>

                    {% if result.raw_answers %}
                        <div class="vstack gap-3">
                            {% for key, text in questions.items() %}
                                {% set ans = result.raw_answers.get(key, '0') %}
                                <div class="d-flex align-items-start p-3 rounded border {{ 'bg-danger bg-opacity-10 border-danger border-opacity-25' if ans == '1' else 'bg-light' }}">
                                    <div class="me-3 fw-bold text-muted">{{ loop.index }}.</div>
                                    <div class="flex-grow-1">
                                        <div class="mb-1 {{ 'text-dark fw-medium' if ans == '1' else 'text-muted' }}">{{ text }}</div>
                                    </div>
                                    <div class="ms-3">
                                        {% if ans == '1' %}
                                            <span class="badge bg-danger text-white px-3">Ya</span>
                                        {% else %}
                                            <span class="badge bg-secondary text-white opacity-50 px-3">Tidak</span>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-archive display-4 d-block mb-3 opacity-25"></i>
                            <p>Data jawaban mentah tidak tersedia untuk tes lama ini.</p>
                        </div>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}